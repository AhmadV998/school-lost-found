<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Lost & Found Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF6B6B;
            --secondary: #4ECDC4;
            --accent: #FFE66D;
            --dark: #2C3E50;
            --light: #F8F9FA;
            --success: #51CF66;
            --purple: #9775FA;
            --orange: #FF922B;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            flex-direction: column;
            gap: 20px;
        }

        .loading.hidden {
            display: none;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: white;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            animation: fadeIn 0.4s ease-out;
        }

        .login-screen.hidden {
            display: none;
        }

        .login-container {
            background: white;
            border-radius: 25px;
            padding: 50px 40px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 30px 80px rgba(0,0,0,0.4);
            animation: modalSlideUp 0.5s ease-out;
            text-align: center;
        }

        .login-logo {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: bounce 1s ease infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .login-title {
            font-family: 'Fredoka', sans-serif;
            font-size: 2.5rem;
            color: var(--dark);
            margin-bottom: 10px;
            font-weight: 700;
        }

        .login-subtitle {
            color: #6c757d;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .login-tabs {
            display: flex;
            gap: 0;
            margin-bottom: 30px;
            background: #f1f3f5;
            border-radius: 12px;
            padding: 4px;
        }

        .login-tab {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: transparent;
            border-radius: 10px;
            font-family: 'DM Sans', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #6c757d;
            font-size: 1rem;
        }

        .login-tab.active {
            background: white;
            color: var(--secondary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .login-form {
            display: none;
        }

        .login-form.active {
            display: block;
        }

        .login-input-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .login-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95rem;
        }

        .login-input, .login-select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .login-input:focus, .login-select:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 4px rgba(78, 205, 196, 0.1);
        }

        .grade-section-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .login-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--secondary), #45b8b0);
            color: white;
            border: none;
            border-radius: 12px;
            font-family: 'Fredoka', sans-serif;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.4);
            margin-top: 10px;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.5);
        }

        .login-btn:active {
            transform: translateY(0);
        }

        .login-error {
            background: #ffe0e0;
            color: var(--primary);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
            display: none;
        }

        .login-error.show {
            display: block;
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .top-bar {
            background: white;
            border-radius: 20px;
            padding: 15px 25px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            animation: slideDown 0.6s ease-out;
            flex-wrap: wrap;
            gap: 15px;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--secondary), var(--purple));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .user-details h3 {
            font-family: 'Fredoka', sans-serif;
            font-size: 1.2rem;
            color: var(--dark);
            margin-bottom: 2px;
        }

        .user-details p {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .user-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--accent), #ffd43b);
            color: var(--dark);
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 700;
            margin-top: 4px;
        }

        .top-bar-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .stats-badge {
            background: linear-gradient(135deg, #e7f5ff, #d0ebff);
            color: #1971c2;
            padding: 8px 16px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .messages-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, var(--purple), #845ef7);
            color: white;
            border: 2px solid transparent;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'DM Sans', sans-serif;
            position: relative;
        }

        .messages-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(151, 117, 250, 0.4);
        }

        .unread-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--primary);
            color: white;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .logout-btn {
            padding: 10px 20px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--dark);
            font-family: 'DM Sans', sans-serif;
        }

        .logout-btn:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            animation: slideDown 0.6s ease-out 0.1s both;
        }

        h1 {
            font-family: 'Fredoka', sans-serif;
            font-size: 4rem;
            font-weight: 700;
            color: white;
            text-shadow: 4px 4px 0px rgba(0,0,0,0.2);
            margin-bottom: 10px;
            letter-spacing: -2px;
        }

        .tagline {
            font-size: 1.2rem;
            color: rgba(255,255,255,0.9);
            font-weight: 500;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
            animation: fadeInUp 0.8s ease-out 0.2s both;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes modalSlideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            background: white;
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 70px rgba(0,0,0,0.4);
        }

        .card h2 {
            font-family: 'Fredoka', sans-serif;
            font-size: 2rem;
            color: var(--dark);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .icon.lost {
            background: linear-gradient(135deg, var(--primary), #ff8787);
        }

        .icon.found {
            background: linear-gradient(135deg, var(--secondary), #6ee7df);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95rem;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 4px rgba(78, 205, 196, 0.1);
        }

        .image-input {
            padding: 10px;
            background: #f8f9fa;
            cursor: pointer;
        }

        .image-input::-webkit-file-upload-button {
            background: linear-gradient(135deg, var(--secondary), #45b8b0);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'DM Sans', sans-serif;
        }

        .image-input::-webkit-file-upload-button:hover {
            opacity: 0.9;
        }

        .image-preview {
            margin-top: 12px;
            display: none;
            position: relative;
        }

        .image-preview.show {
            display: block;
        }

        .image-preview img {
            width: 100%;
            max-height: 250px;
            object-fit: cover;
            border-radius: 12px;
            border: 2px solid #e9ecef;
        }

        .image-preview-remove {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--primary);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        .image-preview-remove:hover {
            background: #ff5252;
            transform: scale(1.1);
        }

        .item-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .item-image:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            background: linear-gradient(135deg, var(--secondary), #45b8b0);
            color: white;
            border: none;
            padding: 14px 32px;
            border-radius: 12px;
            font-family: 'Fredoka', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.4);
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.5);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.btn-lost {
            background: linear-gradient(135deg, var(--primary), #ff8787);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }

        .btn.btn-lost:hover {
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.5);
        }

        .items-section {
            background: white;
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: fadeInUp 0.8s ease-out 0.4s both;
        }

        .items-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .items-header h2 {
            font-family: 'Fredoka', sans-serif;
            font-size: 2rem;
            color: var(--dark);
        }

        .filter-tabs {
            display: flex;
            gap: 10px;
            background: #f1f3f5;
            padding: 5px;
            border-radius: 12px;
            flex-wrap: wrap;
        }

        .filter-tab {
            padding: 10px 20px;
            border: none;
            background: transparent;
            border-radius: 8px;
            font-family: 'DM Sans', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #6c757d;
        }

        .filter-tab.active {
            background: white;
            color: var(--secondary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .search-filter-row {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 16px 12px 45px;
            background: #f8f9fa;
            border: 2px solid transparent;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%236c757d' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cpath d='m21 21-4.35-4.35'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: 15px center;
        }

        .category-filter {
            padding: 12px 16px;
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 12px;
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .item-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 16px;
            padding: 20px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
            animation: scaleIn 0.4s ease-out both;
            position: relative;
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border-color: var(--secondary);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .item-status {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .item-status.lost {
            background: linear-gradient(135deg, #fff5f5, #ffe0e0);
            color: var(--primary);
        }

        .item-status.found {
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            color: #16a34a;
        }

        .item-status.claimed {
            background: linear-gradient(135deg, #fff9db, #ffec99);
            color: #e67700;
        }

        .item-status.resolved {
            background: linear-gradient(135deg, #e7f5ff, #d0ebff);
            color: #1971c2;
        }

        .item-name {
            font-family: 'Fredoka', sans-serif;
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 8px;
        }

        .item-category {
            display: inline-block;
            padding: 4px 10px;
            background: var(--accent);
            color: var(--dark);
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .item-description {
            color: #6c757d;
            font-size: 0.95rem;
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .item-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
            font-size: 0.85rem;
        }

        .item-meta-item {
            color: #868e96;
        }

        .item-meta-item strong {
            color: var(--secondary);
            font-weight: 600;
        }

        .item-reporter {
            font-size: 0.85rem;
            color: #868e96;
            margin-top: 8px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .item-reporter strong {
            color: var(--dark);
            font-weight: 600;
        }

        .item-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 12px;
        }

        .btn-claim, .btn-mark-resolved, .btn-message {
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            border: none;
            font-family: 'DM Sans', sans-serif;
        }

        .btn-claim {
            background: linear-gradient(135deg, var(--success), #40c057);
            color: white;
        }

        .btn-claim:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(81, 207, 102, 0.4);
        }

        .btn-message {
            background: linear-gradient(135deg, var(--purple), #845ef7);
            color: white;
        }

        .btn-message:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(151, 117, 250, 0.4);
        }

        .btn-mark-resolved {
            background: linear-gradient(135deg, var(--orange), #fd7e14);
            color: white;
            grid-column: 1 / -1;
        }

        .btn-mark-resolved:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 146, 43, 0.4);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #868e96;
            grid-column: 1 / -1;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease-out;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 25px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 70px rgba(0,0,0,0.5);
            animation: modalSlideUp 0.4s ease-out;
        }

        .modal-content h3 {
            font-family: 'Fredoka', sans-serif;
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--dark);
        }

        .btn-close {
            background: #e9ecef;
            color: var(--dark);
            margin-top: 10px;
        }

        .btn-close:hover {
            background: #dee2e6;
        }

        .success-message {
            background: linear-gradient(135deg, #d3f9d8, #b2f2bb);
            color: #2b8a3e;
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: 600;
            display: none;
            animation: slideDown 0.4s ease-out;
        }

        .success-message.show {
            display: block;
        }

        .image-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
            cursor: pointer;
        }

        .image-modal.active {
            display: flex;
        }

        .image-modal img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            border-radius: 12px;
        }

        .image-modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            color: var(--dark);
            border: none;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        .image-modal-close:hover {
            background: var(--light);
            transform: scale(1.1);
        }

        /* Messages Modal */
        .messages-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 3000;
            animation: fadeIn 0.3s ease-out;
        }

        .messages-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .messages-container {
            background: white;
            border-radius: 20px;
            max-width: 900px;
            width: 90%;
            height: 80vh;
            max-height: 700px;
            display: grid;
            grid-template-columns: 300px 1fr;
            overflow: hidden;
            box-shadow: 0 30px 90px rgba(0,0,0,0.5);
            animation: modalSlideUp 0.4s ease-out;
        }

        .conversations-list {
            background: #f8f9fa;
            border-right: 2px solid #e9ecef;
            overflow-y: auto;
        }

        .conversations-header {
            padding: 20px;
            background: linear-gradient(135deg, var(--purple), #845ef7);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .conversations-header h3 {
            font-family: 'Fredoka', sans-serif;
            font-size: 1.3rem;
        }

        .close-messages {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .close-messages:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }

        .conversation-item {
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .conversation-item:hover {
            background: #e9ecef;
        }

        .conversation-item.active {
            background: white;
            border-left: 4px solid var(--purple);
        }

        .conversation-item.unread {
            background: #fff3e0;
        }

        .conversation-name {
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 4px;
            font-size: 1rem;
        }

        .conversation-preview {
            color: #6c757d;
            font-size: 0.85rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .conversation-time {
            font-size: 0.75rem;
            color: #adb5bd;
            margin-top: 4px;
        }

        .unread-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 10px;
            height: 10px;
            background: var(--primary);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        .chat-area {
            display: flex;
            flex-direction: column;
            background: white;
        }

        .chat-header {
            padding: 20px 25px;
            background: white;
            border-bottom: 2px solid #e9ecef;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .chat-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--secondary), var(--purple));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.2rem;
        }

        .chat-user-info h4 {
            font-family: 'Fredoka', sans-serif;
            color: var(--dark);
            margin-bottom: 2px;
        }

        .chat-user-info p {
            color: #6c757d;
            font-size: 0.85rem;
        }

        .messages-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            display: flex;
            gap: 10px;
            max-width: 70%;
            animation: fadeIn 0.3s ease-out;
        }

        .message.sent {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--secondary), var(--purple));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .message-content {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .message-bubble {
            padding: 12px 16px;
            border-radius: 18px;
            word-wrap: break-word;
        }

        .message.received .message-bubble {
            background: #f1f3f5;
            color: var(--dark);
            border-top-left-radius: 4px;
        }

        .message.sent .message-bubble {
            background: linear-gradient(135deg, var(--purple), #845ef7);
            color: white;
            border-top-right-radius: 4px;
        }

        .message-time {
            font-size: 0.75rem;
            color: #adb5bd;
            padding: 0 8px;
        }

        .message.sent .message-time {
            text-align: right;
        }

        .chat-input-area {
            padding: 20px;
            background: white;
            border-top: 2px solid #e9ecef;
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--purple);
            box-shadow: 0 0 0 4px rgba(151, 117, 250, 0.1);
        }

        .send-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--purple), #845ef7);
            color: white;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'DM Sans', sans-serif;
        }

        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(151, 117, 250, 0.4);
        }

        /* IMPROVED EMPTY CHAT STATE */
        .empty-chat {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            flex-direction: column;
            gap: 20px;
            padding: 40px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
        }

        .empty-chat-illustration {
            width: 200px;
            height: 200px;
            background: linear-gradient(135deg, #e7f5ff, #d0ebff);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
        }

        .empty-chat-illustration::before {
            content: 'üí¨';
            font-size: 5rem;
            position: absolute;
            animation: bounce 2s ease-in-out infinite;
        }

        .empty-chat-illustration::after {
            content: '';
            position: absolute;
            width: 220px;
            height: 220px;
            border: 3px dashed #adb5bd;
            border-radius: 50%;
            opacity: 0.3;
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .empty-chat-content {
            text-align: center;
            max-width: 400px;
        }

        .empty-chat-content h3 {
            font-family: 'Fredoka', sans-serif;
            font-size: 1.8rem;
            color: var(--dark);
            margin-bottom: 12px;
        }

        .empty-chat-content p {
            color: #6c757d;
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .empty-chat-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }

        .empty-chat-feature {
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }

        .empty-chat-feature:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .empty-chat-feature-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .empty-chat-feature-text {
            font-size: 0.85rem;
            color: #6c757d;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }

            .main-content {
                grid-template-columns: 1fr;
            }

            .items-header {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-tabs {
                width: 100%;
                justify-content: center;
            }

            .items-grid {
                grid-template-columns: 1fr;
            }

            .top-bar {
                flex-direction: column;
                gap: 15px;
            }

            .top-bar-actions {
                width: 100%;
                justify-content: space-between;
                flex-wrap: wrap;
            }

            .search-filter-row {
                grid-template-columns: 1fr;
            }

            .item-actions {
                grid-template-columns: 1fr;
            }

            .grade-section-row {
                grid-template-columns: 1fr;
            }

            .messages-container {
                grid-template-columns: 1fr;
                width: 95%;
                height: 90vh;
            }

            .conversations-list {
                display: none;
            }

            .messages-container.show-list .conversations-list {
                display: block;
            }

            .messages-container.show-list .chat-area {
                display: none;
            }

            .message {
                max-width: 85%;
            }

            .empty-chat-illustration {
                width: 150px;
                height: 150px;
            }

            .empty-chat-illustration::before {
                font-size: 3.5rem;
            }

            .empty-chat-features {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="loading" id="loadingScreen">
        <div class="spinner"></div>
        <div class="loading-text">Loading...</div>
    </div>

    <div class="login-screen hidden" id="loginScreen">
        <div class="login-container">
            <div class="login-logo">üéí</div>
            <h2 class="login-title">School Lost & Found</h2>
            <p class="login-subtitle">Sign in to continue</p>

            <div class="login-error" id="loginError"></div>

            <div class="login-tabs">
                <button class="login-tab active" onclick="switchLoginTab('login')">Login</button>
                <button class="login-tab" onclick="switchLoginTab('signup')">Sign Up</button>
            </div>

            <form class="login-form active" id="loginForm">
                <div class="login-input-group">
                    <label class="login-label">Username</label>
                    <input type="text" class="login-input" id="loginUsername" placeholder="Enter your username" required>
                </div>
                <div class="login-input-group">
                    <label class="login-label">Password</label>
                    <input type="password" class="login-input" id="loginPassword" placeholder="Enter your password" required>
                </div>
                <button type="submit" class="login-btn">Login</button>
            </form>

            <form class="login-form" id="signupForm">
                <div class="login-input-group">
                    <label class="login-label">Username</label>
                    <input type="text" class="login-input" id="signupUsername" placeholder="Choose a username" required>
                </div>
                <div class="login-input-group">
                    <label class="login-label">Email</label>
                    <input type="email" class="login-input" id="signupEmail" placeholder="your.email@school.edu" required>
                </div>
                <div class="grade-section-row">
                    <div class="login-input-group">
                        <label class="login-label">Grade Level</label>
                        <select class="login-select" id="signupGrade" required>
                            <option value="">Select</option>
                            <option value="7">Grade 7</option>
                            <option value="8">Grade 8</option>
                            <option value="9">Grade 9</option>
                            <option value="10">Grade 10</option>
                            <option value="11">Grade 11</option>
                            <option value="12">Grade 12</option>
                        </select>
                    </div>
                    <div class="login-input-group">
                        <label class="login-label">Section</label>
                        <input type="text" class="login-input" id="signupSection" placeholder="e.g. A, Einstein" required>
                    </div>
                </div>
                <div class="login-input-group">
                    <label class="login-label">Password</label>
                    <input type="password" class="login-input" id="signupPassword" placeholder="Create a password" required>
                </div>
                <div class="login-input-group">
                    <label class="login-label">Confirm Password</label>
                    <input type="password" class="login-input" id="signupConfirmPassword" placeholder="Confirm your password" required>
                </div>
                <button type="submit" class="login-btn">Create Account</button>
            </form>
        </div>
    </div>

    <div class="container" id="mainApp" style="display: none;">
        <div class="top-bar">
            <div class="user-info">
                <div class="user-avatar" id="userAvatar"></div>
                <div class="user-details">
                    <h3 id="displayUsername">Username</h3>
                    <p id="displayEmail">email@school.edu</p>
                    <div class="user-badge" id="userBadge">Grade 10 - Section A</div>
                </div>
            </div>
            <div class="top-bar-actions">
                <div class="stats-badge" id="userStats">üìä My Items: 0</div>
                <button class="messages-btn" onclick="openMessagesModal()">
                    üí¨ Messages
                    <span class="unread-badge" id="unreadBadge" style="display: none;">0</span>
                </button>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>

        <header>
            <h1>üîç Lost & Found Pro</h1>
            <p class="tagline">Help each other find what's missing!</p>
        </header>

        <div class="main-content">
            <div class="card">
                <h2><span class="icon lost">üò¢</span> Lost Something?</h2>
                <form id="lostForm">
                    <div class="form-group">
                        <label for="lostItemName">What did you lose?</label>
                        <input type="text" id="lostItemName" placeholder="e.g. ID, calculator, umbrella" required>
                    </div>
                    <div class="form-group">
                        <label for="lostCategory">Category</label>
                        <select id="lostCategory" required>
                            <option value="">Select category</option>
                            <option value="ID">ID / Card</option>
                            <option value="Gadgets">Gadgets</option>
                            <option value="School Supplies">School Supplies</option>
                            <option value="Personal Items">Personal Items</option>
                            <option value="Clothing">Clothing</option>
                            <option value="Books">Books</option>
                            <option value="Sports Equipment">Sports Equipment</option>
                            <option value="Others">Others</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="lostDescription">Description</label>
                        <textarea id="lostDescription" placeholder="Details like color, brand, distinguishing features" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="lostLocation">Where did you last see it?</label>
                        <input type="text" id="lostLocation" placeholder="e.g. Canteen, Room 301, Gym" required>
                    </div>
                    <div class="form-group">
                        <label for="lostContact">Contact (Email or Phone)</label>
                        <input type="text" id="lostContact" placeholder="your.email@school.edu" required>
                    </div>
                    <div class="form-group">
                        <label for="lostImage">üì∑ Item Photo (Optional)</label>
                        <input type="file" id="lostImage" accept="image/*" class="image-input">
                        <div class="image-preview" id="lostImagePreview"></div>
                    </div>
                    <button type="submit" class="btn btn-lost">Report Lost Item</button>
                </form>
            </div>

            <div class="card">
                <h2><span class="icon found">üòä</span> Found Something?</h2>
                <form id="foundForm">
                    <div class="form-group">
                        <label for="foundItemName">What did you find?</label>
                        <input type="text" id="foundItemName" placeholder="e.g. Wallet, notebook" required>
                    </div>
                    <div class="form-group">
                        <label for="foundCategory">Category</label>
                        <select id="foundCategory" required>
                            <option value="">Select category</option>
                            <option value="ID">ID / Card</option>
                            <option value="Gadgets">Gadgets</option>
                            <option value="School Supplies">School Supplies</option>
                            <option value="Personal Items">Personal Items</option>
                            <option value="Clothing">Clothing</option>
                            <option value="Books">Books</option>
                            <option value="Sports Equipment">Sports Equipment</option>
                            <option value="Others">Others</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="foundDescription">Description</label>
                        <textarea id="foundDescription" placeholder="Item details to help owner identify it" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="foundLocation">Where did you find it?</label>
                        <input type="text" id="foundLocation" placeholder="e.g. Library, Hallway, Playground" required>
                    </div>
                    <div class="form-group">
                        <label for="foundContact">Contact (Email or Phone)</label>
                        <input type="text" id="foundContact" placeholder="your.email@school.edu" required>
                    </div>
                    <div class="form-group">
                        <label for="foundImage">üì∑ Item Photo (Optional)</label>
                        <input type="file" id="foundImage" accept="image/*" class="image-input">
                        <div class="image-preview" id="foundImagePreview"></div>
                    </div>
                    <button type="submit" class="btn">Report Found Item</button>
                </form>
            </div>
        </div>

        <div class="items-section">
            <div class="items-header">
                <h2>üìã All Items</h2>
                <div class="filter-tabs">
                    <button class="filter-tab active" data-filter="all">All</button>
                    <button class="filter-tab" data-filter="lost">Lost</button>
                    <button class="filter-tab" data-filter="found">Found</button>
                    <button class="filter-tab" data-filter="claimed">Claimed</button>
                    <button class="filter-tab" data-filter="resolved">Resolved</button>
                </div>
            </div>

            <div class="search-filter-row">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Search for items...">
                </div>
                <select class="category-filter" id="categoryFilter">
                    <option value="">All Categories</option>
                    <option value="ID">ID / Card</option>
                    <option value="Gadgets">Gadgets</option>
                    <option value="School Supplies">School Supplies</option>
                    <option value="Personal Items">Personal Items</option>
                    <option value="Clothing">Clothing</option>
                    <option value="Books">Books</option>
                    <option value="Sports Equipment">Sports Equipment</option>
                    <option value="Others">Others</option>
                </select>
            </div>

            <div id="successMessage" class="success-message"></div>

            <div class="items-grid" id="itemsGrid">
                <div class="empty-state">
                    <div class="empty-state-icon">üì≠</div>
                    <h3>No items yet</h3>
                    <p>Start by reporting lost or found items above!</p>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="claimModal">
        <div class="modal-content">
            <h3>üéØ Claim Item</h3>
            <p style="margin-bottom: 20px; color: #6c757d;">To claim this item, provide details to help verify ownership. The reporter will be notified.</p>
            <div class="form-group">
                <label for="claimerName">Your Name</label>
                <input type="text" id="claimerName" placeholder="Full name" required>
            </div>
            <div class="form-group">
                <label for="claimerContact">Your Contact</label>
                <input type="text" id="claimerContact" placeholder="Email or phone number" required>
            </div>
            <div class="form-group">
                <label for="claimProof">Proof of Ownership</label>
                <textarea id="claimProof" placeholder="Describe unique features or provide details that prove this item is yours" required></textarea>
            </div>
            <button class="btn" onclick="submitClaim()">Submit Claim</button>
            <button class="btn btn-close" onclick="closeModal()">Cancel</button>
        </div>
    </div>

    <div class="image-modal" id="imageModal">
        <button class="image-modal-close" onclick="closeImageModal()">‚úï</button>
        <img id="imageModalImg" src="" alt="Item image">
    </div>

    <!-- Messages Modal -->
    <div class="messages-modal" id="messagesModal">
        <div class="messages-container">
            <div class="conversations-list">
                <div class="conversations-header">
                    <h3>üí¨ Messages</h3>
                    <button class="close-messages" onclick="closeMessagesModal()">‚úï</button>
                </div>
                <div id="conversationsList"></div>
            </div>
            <div class="chat-area">
                <div id="chatContent">
                    <div class="empty-chat">
                        <div class="empty-chat-illustration"></div>
                        <div class="empty-chat-content">
                            <h3>Start a Conversation</h3>
                            <p>Connect with fellow students to help find lost items or coordinate returns.</p>
                            <div class="empty-chat-features">
                                <div class="empty-chat-feature">
                                    <div class="empty-chat-feature-icon">üîí</div>
                                    <div class="empty-chat-feature-text">Secure & Private</div>
                                </div>
                                <div class="empty-chat-feature">
                                    <div class="empty-chat-feature-icon">‚ö°</div>
                                    <div class="empty-chat-feature-text">Instant Messages</div>
                                </div>
                                <div class="empty-chat-feature">
                                    <div class="empty-chat-feature-icon">ü§ù</div>
                                    <div class="empty-chat-feature-text">Help Each Other</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let items = [];
        let users = [];
        let currentUser = null;
        let currentFilter = "all";
        let currentClaimItem = null;
        let conversations = [];
        let currentConversation = null;

        document.addEventListener('DOMContentLoaded', async function() {
            await loadData();
            
            if (currentUser) {
                showMainApp();
            } else {
                document.getElementById('loadingScreen').classList.add('hidden');
                document.getElementById('loginScreen').classList.remove('hidden');
            }
        });

        async function loadData() {
            try {
                const [itemsResult, usersResult, currentUserResult, conversationsResult] = await Promise.all([
                    window.storage.get('lostFoundItems', true).catch(() => null),
                    window.storage.get('lostFoundUsers', true).catch(() => null),
                    window.storage.get('currentUser', false).catch(() => null),
                    window.storage.get('lostFoundConversations', true).catch(() => null)
                ]);

                items = itemsResult ? JSON.parse(itemsResult.value) : [];
                users = usersResult ? JSON.parse(usersResult.value) : [];
                currentUser = currentUserResult ? JSON.parse(currentUserResult.value) : null;
                conversations = conversationsResult ? JSON.parse(conversationsResult.value) : [];
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        async function saveData() {
            try {
                await Promise.all([
                    window.storage.set('lostFoundItems', JSON.stringify(items), true),
                    window.storage.set('lostFoundUsers', JSON.stringify(users), true),
                    window.storage.set('lostFoundConversations', JSON.stringify(conversations), true)
                ]);
            } catch (error) {
                console.error('Error saving data:', error);
            }
        }

        async function saveCurrentUser() {
            try {
                if (currentUser) {
                    await window.storage.set('currentUser', JSON.stringify(currentUser), false);
                }
            } catch (error) {
                console.error('Error saving current user:', error);
            }
        }

        function switchLoginTab(tab) {
            document.querySelectorAll('.login-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.login-form').forEach(f => f.classList.remove('active'));
            
            if (tab === 'login') {
                document.querySelectorAll('.login-tab')[0].classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.querySelectorAll('.login-tab')[1].classList.add('active');
                document.getElementById('signupForm').classList.add('active');
            }
            
            hideLoginError();
        }

        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                await saveCurrentUser();
                hideLoginError();
                this.reset();
                showMainApp();
            } else {
                showLoginError('Invalid username or password');
            }
        });

        document.getElementById('signupForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('signupUsername').value;
            const email = document.getElementById('signupEmail').value;
            const grade = document.getElementById('signupGrade').value;
            const section = document.getElementById('signupSection').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            
            if (password !== confirmPassword) {
                showLoginError('Passwords do not match');
                return;
            }
            
            if (password.length < 6) {
                showLoginError('Password must be at least 6 characters');
                return;
            }
            
            if (users.find(u => u.username === username)) {
                showLoginError('Username already exists');
                return;
            }
            
            if (users.find(u => u.email === email)) {
                showLoginError('Email already registered');
                return;
            }
            
            const newUser = {
                username: username,
                email: email,
                grade: grade,
                section: section,
                password: password,
                createdAt: new Date().toISOString()
            };
            
            users.push(newUser);
            currentUser = newUser;
            
            await saveData();
            await saveCurrentUser();
            
            hideLoginError();
            this.reset();
            showMainApp();
        });

        function showLoginError(message) {
            const errorEl = document.getElementById('loginError');
            errorEl.textContent = message;
            errorEl.classList.add('show');
        }

        function hideLoginError() {
            document.getElementById('loginError').classList.remove('show');
        }

        function showMainApp() {
            document.getElementById('loadingScreen').classList.add('hidden');
            const loginScreen = document.getElementById('loginScreen');
            loginScreen.style.animation = 'fadeOut 0.3s ease-out';
            
            setTimeout(() => {
                loginScreen.classList.add('hidden');
                document.getElementById('mainApp').style.display = 'block';
                
                showSuccessMessage(`üéâ Welcome back, ${currentUser.username}!`);
            }, 300);
            
            const avatar = currentUser.username.charAt(0).toUpperCase();
            document.getElementById('userAvatar').textContent = avatar;
            document.getElementById('displayUsername').textContent = currentUser.username;
            document.getElementById('displayEmail').textContent = currentUser.email;
            document.getElementById('userBadge').textContent = `Grade ${currentUser.grade} - Section ${currentUser.section}`;
            
            document.getElementById('lostContact').value = currentUser.email;
            document.getElementById('foundContact').value = currentUser.email;
            
            setupImagePreview('lostImage', 'lostImagePreview');
            setupImagePreview('foundImage', 'foundImagePreview');
            
            updateUserStats();
            updateUnreadCount();
            renderItems();
            
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    currentFilter = this.dataset.filter;
                    renderItems();
                });
            });

            document.getElementById('searchInput').addEventListener('input', function(e) {
                renderItems();
            });

            document.getElementById('categoryFilter').addEventListener('change', function() {
                renderItems();
            });
        }

        function setupImagePreview(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            
            input.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        preview.innerHTML = `
                            <img src="${event.target.result}" alt="Preview">
                            <button type="button" class="image-preview-remove" onclick="removeImage('${inputId}', '${previewId}')">‚úï</button>
                        `;
                        preview.classList.add('show');
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        function removeImage(inputId, previewId) {
            document.getElementById(inputId).value = '';
            const preview = document.getElementById(previewId);
            preview.innerHTML = '';
            preview.classList.remove('show');
        }

        async function logout() {
            if (confirm('Are you sure you want to logout?')) {
                try {
                    await window.storage.delete('currentUser', false);
                } catch (error) {
                    console.error('Error deleting current user:', error);
                }
                
                currentUser = null;
                
                const mainApp = document.getElementById('mainApp');
                mainApp.style.animation = 'fadeOut 0.3s ease-out';
                
                setTimeout(() => {
                    mainApp.style.display = 'none';
                    mainApp.style.animation = '';
                    
                    const loginScreen = document.getElementById('loginScreen');
                    loginScreen.classList.remove('hidden');
                    loginScreen.style.animation = 'fadeIn 0.3s ease-out';
                    
                    document.getElementById('loginForm').reset();
                    document.getElementById('signupForm').reset();
                    hideLoginError();
                }, 300);
            }
        }

        document.getElementById('lostForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const imageInput = document.getElementById('lostImage');
            let imageData = null;
            
            if (imageInput.files[0]) {
                const reader = new FileReader();
                imageData = await new Promise((resolve) => {
                    reader.onload = (e) => resolve(e.target.result);
                    reader.readAsDataURL(imageInput.files[0]);
                });
            }
            
            const item = {
                id: Date.now(),
                type: 'lost',
                status: 'active',
                name: document.getElementById('lostItemName').value,
                category: document.getElementById('lostCategory').value,
                description: document.getElementById('lostDescription').value,
                location: document.getElementById('lostLocation').value,
                contact: document.getElementById('lostContact').value,
                reportedBy: currentUser.username,
                reporterGrade: currentUser.grade,
                reporterSection: currentUser.section,
                date: new Date().toLocaleDateString('en-US'),
                timestamp: new Date().toISOString(),
                image: imageData
            };

            items.push(item);
            await saveData();
            
            this.reset();
            document.getElementById('lostContact').value = currentUser.email;
            removeImage('lostImage', 'lostImagePreview');
            showSuccessMessage('‚úÖ Lost item reported successfully!');
            updateUserStats();
            renderItems();
        });

        document.getElementById('foundForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const imageInput = document.getElementById('foundImage');
            let imageData = null;
            
            if (imageInput.files[0]) {
                const reader = new FileReader();
                imageData = await new Promise((resolve) => {
                    reader.onload = (e) => resolve(e.target.result);
                    reader.readAsDataURL(imageInput.files[0]);
                });
            }
            
            const item = {
                id: Date.now(),
                type: 'found',
                status: 'active',
                name: document.getElementById('foundItemName').value,
                category: document.getElementById('foundCategory').value,
                description: document.getElementById('foundDescription').value,
                location: document.getElementById('foundLocation').value,
                contact: document.getElementById('foundContact').value,
                reportedBy: currentUser.username,
                reporterGrade: currentUser.grade,
                reporterSection: currentUser.section,
                date: new Date().toLocaleDateString('en-US'),
                timestamp: new Date().toISOString(),
                image: imageData
            };

            items.push(item);
            await saveData();
            
            this.reset();
            document.getElementById('foundContact').value = currentUser.email;
            removeImage('foundImage', 'foundImagePreview');
            showSuccessMessage('‚úÖ Found item reported successfully!');
            updateUserStats();
            renderItems();
        });

        function updateUserStats() {
            const userItems = items.filter(item => item.reportedBy === currentUser.username);
            document.getElementById('userStats').textContent = `üìä My Items: ${userItems.length}`;
        }

        function renderItems() {
            const grid = document.getElementById('itemsGrid');
            const searchQuery = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            
            let filteredItems = items;

            if (currentFilter !== 'all') {
                if (currentFilter === 'claimed' || currentFilter === 'resolved') {
                    filteredItems = filteredItems.filter(item => item.status === currentFilter);
                } else {
                    filteredItems = filteredItems.filter(item => item.type === currentFilter && item.status === 'active');
                }
            }

            if (searchQuery) {
                filteredItems = filteredItems.filter(item => 
                    item.name.toLowerCase().includes(searchQuery) ||
                    item.description.toLowerCase().includes(searchQuery) ||
                    item.category.toLowerCase().includes(searchQuery) ||
                    item.location.toLowerCase().includes(searchQuery)
                );
            }

            if (categoryFilter) {
                filteredItems = filteredItems.filter(item => item.category === categoryFilter);
            }

            if (filteredItems.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üîç</div>
                        <h3>No items found</h3>
                        <p>${searchQuery || categoryFilter ? 'Try a different search or filter' : 'Report items above!'}</p>
                    </div>
                `;
                return;
            }

            filteredItems.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            grid.innerHTML = filteredItems.map((item, index) => `
                <div class="item-card" style="animation-delay: ${Math.min(index * 0.05, 0.5)}s">
                    ${item.image ? `<img src="${item.image}" alt="${item.name}" class="item-image" onclick="openImageModal(${item.id})">` : ''}
                    <div class="item-header">
                        <div class="item-status ${item.status === 'active' ? item.type : item.status}">
                            ${item.status === 'active' ? (item.type === 'lost' ? 'üî¥ Lost' : 'üü¢ Found') : 
                              item.status === 'claimed' ? '‚è≥ Claimed' : '‚úÖ Resolved'}
                        </div>
                    </div>
                    <div class="item-name">${item.name}</div>
                    <div class="item-category">${item.category}</div>
                    <div class="item-description">${item.description}</div>
                    <div class="item-meta">
                        <div class="item-meta-item">üìÖ ${item.date}</div>
                        <div class="item-meta-item"><strong>üìç ${item.location}</strong></div>
                    </div>
                    <div class="item-reporter">
                        <strong>Reported by:</strong> ${item.reportedBy}<br>
                        Grade ${item.reporterGrade} - Section ${item.reporterSection}
                    </div>
                    ${item.reportedBy !== currentUser.username && item.status === 'active' ? `
                        <div class="item-actions">
                            ${item.type === 'found' ? `<button class="btn-claim" onclick="openClaimModal(${item.id})">Claim Item</button>` : ''}
                            <button class="btn-message" onclick="startConversation('${item.reportedBy}', ${item.id})">üí¨ Message</button>
                        </div>
                    ` : ''}
                    ${item.status === 'claimed' && item.reportedBy === currentUser.username ? `
                        <div class="item-actions">
                            <button class="btn-mark-resolved" onclick="markResolved(${item.id})">Mark as Resolved</button>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function openClaimModal(itemId) {
            currentClaimItem = items.find(item => item.id === itemId);
            document.getElementById('claimModal').classList.add('active');
            document.getElementById('claimerName').value = currentUser.username;
            document.getElementById('claimerContact').value = currentUser.email;
        }

        function closeModal() {
            document.getElementById('claimModal').classList.remove('active');
            document.getElementById('claimerName').value = '';
            document.getElementById('claimerContact').value = '';
            document.getElementById('claimProof').value = '';
            currentClaimItem = null;
        }

        async function submitClaim() {
            const claimerName = document.getElementById('claimerName').value;
            const claimerContact = document.getElementById('claimerContact').value;
            const claimProof = document.getElementById('claimProof').value;

            if (!claimerName || !claimerContact || !claimProof) {
                alert('Please fill in all fields');
                return;
            }

            const itemIndex = items.findIndex(item => item.id === currentClaimItem.id);
            if (itemIndex !== -1) {
                items[itemIndex].status = 'claimed';
                items[itemIndex].claimedBy = claimerName;
                items[itemIndex].claimerContact = claimerContact;
                items[itemIndex].claimProof = claimProof;
                items[itemIndex].claimedDate = new Date().toLocaleDateString('en-US');
                
                await saveData();
            }

            closeModal();
            showSuccessMessage('‚úÖ Claim request submitted! The reporter will be notified.');
            renderItems();
        }

        async function markResolved(itemId) {
            if (confirm('Mark this item as resolved? This means the item has been successfully returned to its owner.')) {
                const itemIndex = items.findIndex(item => item.id === itemId);
                if (itemIndex !== -1) {
                    items[itemIndex].status = 'resolved';
                    items[itemIndex].resolvedDate = new Date().toLocaleDateString('en-US');
                    
                    await saveData();
                    showSuccessMessage('‚úÖ Item marked as resolved!');
                    renderItems();
                }
            }
        }

        function showSuccessMessage(message) {
            const msgEl = document.getElementById('successMessage');
            msgEl.textContent = message;
            msgEl.classList.add('show');
            
            setTimeout(() => {
                msgEl.classList.remove('show');
            }, 5000);
        }

        function openImageModal(itemId) {
            const item = items.find(i => i.id === itemId);
            if (item && item.image) {
                document.getElementById('imageModalImg').src = item.image;
                document.getElementById('imageModal').classList.add('active');
            }
        }

        function closeImageModal() {
            document.getElementById('imageModal').classList.remove('active');
        }

        // Messages Functions
        async function startConversation(withUser, itemId) {
            const item = items.find(i => i.id === itemId);
            let conversation = conversations.find(c => 
                (c.user1 === currentUser.username && c.user2 === withUser) ||
                (c.user2 === currentUser.username && c.user1 === withUser)
            );

            if (!conversation) {
                conversation = {
                    id: Date.now(),
                    user1: currentUser.username,
                    user2: withUser,
                    messages: [],
                    itemId: itemId,
                    itemName: item ? item.name : 'Item',
                    createdAt: new Date().toISOString()
                };
                conversations.push(conversation);
                await saveData();
            }

            currentConversation = conversation;
            openMessagesModal();
            renderConversation(conversation);
        }

        function openMessagesModal() {
            document.getElementById('messagesModal').classList.add('active');
            renderConversationsList();
        }

        function closeMessagesModal() {
            document.getElementById('messagesModal').classList.remove('active');
        }

        function renderConversationsList() {
            const list = document.getElementById('conversationsList');
            const userConversations = conversations.filter(c => 
                c.user1 === currentUser.username || c.user2 === currentUser.username
            );

            if (userConversations.length === 0) {
                list.innerHTML = '<div class="empty-state"><p>No messages yet</p></div>';
                return;
            }

            list.innerHTML = userConversations.map(conv => {
                const otherUser = conv.user1 === currentUser.username ? conv.user2 : conv.user1;
                const lastMessage = conv.messages[conv.messages.length - 1];
                const hasUnread = conv.messages.some(m => m.sender !== currentUser.username && !m.read);
                
                return `
                    <div class="conversation-item ${currentConversation && currentConversation.id === conv.id ? 'active' : ''} ${hasUnread ? 'unread' : ''}" 
                         onclick="selectConversation(${conv.id})">
                        ${hasUnread ? '<div class="unread-indicator"></div>' : ''}
                        <div class="conversation-name">${otherUser}</div>
                        <div class="conversation-preview">
                            ${lastMessage ? (lastMessage.sender === currentUser.username ? 'You: ' : '') + lastMessage.text : 'About: ' + conv.itemName}
                        </div>
                        <div class="conversation-time">${lastMessage ? formatTime(lastMessage.timestamp) : formatTime(conv.createdAt)}</div>
                    </div>
                `;
            }).join('');
        }

        async function selectConversation(convId) {
            currentConversation = conversations.find(c => c.id === convId);
            if (currentConversation) {
                currentConversation.messages.forEach(m => {
                    if (m.sender !== currentUser.username) {
                        m.read = true;
                    }
                });
                await saveData();
                updateUnreadCount();
                renderConversationsList();
                renderConversation(currentConversation);
            }
        }

        function renderConversation(conversation) {
            const chatContent = document.getElementById('chatContent');
            const otherUser = conversation.user1 === currentUser.username ? conversation.user2 : conversation.user1;
            const otherUserData = users.find(u => u.username === otherUser) || { grade: '?', section: '?' };
            
            if (!conversation || !conversation.messages) {
                chatContent.innerHTML = `
                    <div class="empty-chat">
                        <div class="empty-chat-illustration"></div>
                        <div class="empty-chat-content">
                            <h3>Start a Conversation</h3>
                            <p>Connect with fellow students to help find lost items or coordinate returns.</p>
                            <div class="empty-chat-features">
                                <div class="empty-chat-feature">
                                    <div class="empty-chat-feature-icon">üîí</div>
                                    <div class="empty-chat-feature-text">Secure & Private</div>
                                </div>
                                <div class="empty-chat-feature">
                                    <div class="empty-chat-feature-icon">‚ö°</div>
                                    <div class="empty-chat-feature-text">Instant Messages</div>
                                </div>
                                <div class="empty-chat-feature">
                                    <div class="empty-chat-feature-icon">ü§ù</div>
                                    <div class="empty-chat-feature-text">Help Each Other</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }

            chatContent.innerHTML = `
                <div class="chat-header">
                    <div class="chat-avatar">${otherUser.charAt(0).toUpperCase()}</div>
                    <div class="chat-user-info">
                        <h4>${otherUser}</h4>
                        <p>Grade ${otherUserData.grade} - Section ${otherUserData.section}</p>
                    </div>
                </div>
                <div class="messages-area" id="messagesArea">
                    ${conversation.messages.length > 0 ? conversation.messages.map(msg => `
                        <div class="message ${msg.sender === currentUser.username ? 'sent' : 'received'}">
                            <div class="message-avatar">${msg.sender.charAt(0).toUpperCase()}</div>
                            <div class="message-content">
                                <div class="message-bubble">${msg.text}</div>
                                <div class="message-time">${formatTime(msg.timestamp)}</div>
                            </div>
                        </div>
                    `).join('') : `
                        <div class="empty-chat">
                            <div class="empty-chat-illustration"></div>
                            <div class="empty-chat-content">
                                <h3>No messages yet</h3>
                                <p>Start the conversation! Say hi! üëã</p>
                            </div>
                        </div>
                    `}
                </div>
                <div class="chat-input-area">
                    <input type="text" class="chat-input" id="messageInput" placeholder="Type a message..." onkeypress="if(event.key==='Enter') sendMessage()">
                    <button class="send-btn" onclick="sendMessage()">Send</button>
                </div>
            `;

            setTimeout(() => {
                const messagesArea = document.getElementById('messagesArea');
                if (messagesArea) {
                    messagesArea.scrollTop = messagesArea.scrollHeight;
                }
            }, 100);
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text || !currentConversation) return;

            const message = {
                id: Date.now(),
                sender: currentUser.username,
                text: text,
                timestamp: new Date().toISOString(),
                read: false
            };

            currentConversation.messages.push(message);
            await saveData();

            input.value = '';
            renderConversation(currentConversation);
            renderConversationsList();
        }

        function updateUnreadCount() {
            const unreadCount = conversations.reduce((count, conv) => {
                if (conv.user1 === currentUser.username || conv.user2 === currentUser.username) {
                    return count + conv.messages.filter(m => m.sender !== currentUser.username && !m.read).length;
                }
                return count;
            }, 0);

            const badge = document.getElementById('unreadBadge');
            if (unreadCount > 0) {
                badge.textContent = unreadCount > 9 ? '9+' : unreadCount;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'Just now';
            if (diff < 3600000) return Math.floor(diff / 60000) + 'm ago';
            if (diff < 86400000) return Math.floor(diff / 3600000) + 'h ago';
            if (diff < 604800000) return Math.floor(diff / 86400000) + 'd ago';
            
            return date.toLocaleDateString();
        }

        document.getElementById('claimModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        document.getElementById('imageModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeImageModal();
            }
        });

        document.getElementById('messagesModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeMessagesModal();
            }
        });
    </script>
</body>
</html>
